<%- include('partials/header', { title, page }) %>

<div class="content-header">
  <h2><i class="fas fa-user-clock"></i> İnsanlaştırma Ayarları</h2>
</div>

<% if (saved) { %>
<div class="alert alert-success" style="margin-bottom: 20px;">
  <i class="fas fa-check-circle"></i> Ayarlar başarıyla kaydedildi!
</div>
<% } %>

<form action="/humanization" method="POST">
  <!-- Ana Kontroller -->
  <div class="card" style="margin-bottom: 20px;">
    <div class="card-header">
      <h3><i class="fas fa-power-off"></i> Temel Kontroller</h3>
    </div>
    <div class="card-body">
      <div class="grid" style="grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 20px;">

        <!-- İnsanlaştırma Modu -->
        <div class="switch-card">
          <div class="switch-info">
            <div class="switch-title">İnsanlaştırma Modu</div>
            <div class="switch-desc">Kapalıyken bot anında cevap verir</div>
          </div>
          <label class="switch">
            <input type="checkbox" name="enabled" <%= config.enabled ? 'checked' : '' %>>
            <span class="slider"></span>
          </label>
        </div>

        <!-- Yazıyor Göstergesi -->
        <div class="switch-card">
          <div class="switch-info">
            <div class="switch-title">"Yazıyor..." Göstergesi</div>
            <div class="switch-desc">WhatsApp'ta "yazıyor..." durumu gösterilsin mi?</div>
          </div>
          <label class="switch">
            <input type="checkbox" name="show_typing_indicator" <%= config.show_typing_indicator !== false ? 'checked' : '' %>>
            <span class="slider"></span>
          </label>
        </div>

        <!-- Parça Parça Gönderme -->
        <div class="switch-card">
          <div class="switch-info">
            <div class="switch-title">Parça Parça Gönderme</div>
            <div class="switch-desc">Uzun cevapları ayrı mesajlar halinde gönder</div>
          </div>
          <label class="switch">
            <input type="checkbox" name="split_messages" <%= config.split_messages !== false ? 'checked' : '' %>>
            <span class="slider"></span>
          </label>
        </div>

      </div>
    </div>
  </div>

  <div class="grid" style="grid-template-columns: repeat(auto-fit, minmax(400px, 1fr)); gap: 20px; margin-bottom: 20px;">

    <!-- Tepki Süresi Kartı -->
    <div class="card">
      <div class="card-header">
        <h3><i class="fas fa-hourglass-half"></i> Tepki Süresi (Düşünme Payı)</h3>
      </div>
      <div class="card-body">
        <div class="form-group">
          <label class="form-label">
            Minimum Bekleme
            <span class="badge badge-info" id="minVal"><%= config.min_response_delay %> sn</span>
          </label>
          <input type="range" class="form-control" name="min_response_delay" min="0" max="1800" step="10"
                 value="<%= config.min_response_delay %>"
                 oninput="document.getElementById('minVal').innerText = this.value + ' sn'">
          <small class="text-muted">Mesajı okuduktan sonra en az ne kadar beklesin? (60 = 1 dk)</small>
        </div>

        <div class="form-group" style="margin-top: 16px;">
          <label class="form-label">
            Maksimum Bekleme
            <span class="badge badge-info" id="maxVal"><%= config.max_response_delay %> sn</span>
          </label>
          <input type="range" class="form-control" name="max_response_delay" min="60" max="3600" step="30"
                 value="<%= config.max_response_delay %>"
                 oninput="document.getElementById('maxVal').innerText = this.value + ' sn'">
          <small class="text-muted">Min-Max arasında rastgele süre seçilir. (600 = 10 dk)</small>
        </div>
      </div>
    </div>

    <!-- Okuma/Yazma Hızı Kartı -->
    <div class="card">
      <div class="card-header">
        <h3><i class="fas fa-keyboard"></i> Okuma & Yazma Hızı</h3>
      </div>
      <div class="card-body">
        <div class="grid" style="grid-template-columns: 1fr 1fr; gap: 16px;">
          <div class="form-group">
            <label class="form-label">Okuma Hızı (Kelime/dk)</label>
            <input type="number" class="form-control" name="wpm_reading" value="<%= config.wpm_reading %>">
            <small class="text-muted">Ortalama insan: 200-250</small>
          </div>
          <div class="form-group">
            <label class="form-label">Yazma Hızı (Karakter/dk)</label>
            <input type="number" class="form-control" name="cpm_typing" value="<%= config.cpm_typing %>">
            <small class="text-muted">Mobil yazma: 180-300</small>
          </div>
        </div>
        <div class="form-group" style="margin-top: 16px;">
          <label class="form-label">
            Yazma Hızı Değişkenliği
            <span class="badge badge-secondary" id="varVal">±<%= config.typing_variance %>%</span>
          </label>
          <input type="range" class="form-control" name="typing_variance" min="0" max="50"
                 value="<%= config.typing_variance %>"
                 oninput="document.getElementById('varVal').innerText = '±' + this.value + '%'">
          <small class="text-muted">Her mesajda yazma hızına doğallık katan rastgele varyasyon</small>
        </div>
      </div>
    </div>
  </div>

  <!-- Alt Ayarlar -->
  <div class="grid" style="grid-template-columns: repeat(auto-fit, minmax(400px, 1fr)); gap: 20px; margin-bottom: 20px;">

    <!-- Uzun Mesaj Algoritması -->
    <div class="card">
      <div class="card-header">
        <h3><i class="fas fa-file-alt"></i> Uzun Mesaj Algoritması</h3>
      </div>
      <div class="card-body">
        <div class="grid" style="grid-template-columns: 1fr 1fr; gap: 16px;">
          <div class="form-group">
            <label class="form-label">Uzun Mesaj Eşiği (Karakter)</label>
            <input type="number" class="form-control" name="long_message_threshold" value="<%= config.long_message_threshold %>">
            <small class="text-muted">Bu sayıyı geçen mesajlar "uzun" sayılır</small>
          </div>
          <div class="form-group">
            <label class="form-label">Ekstra Bekleme (Saniye)</label>
            <input type="number" class="form-control" name="long_message_extra_delay" value="<%= config.long_message_extra_delay %>">
            <small class="text-muted">Uzun mesajda okuma süresine eklenir</small>
          </div>
        </div>
      </div>
    </div>

    <!-- Parça Parça Gönderme Ayarları -->
    <div class="card">
      <div class="card-header">
        <h3><i class="fas fa-puzzle-piece"></i> Mesaj Bölme Ayarları</h3>
      </div>
      <div class="card-body">
        <div class="form-group">
          <label class="form-label">Bölme Eşiği (Karakter)</label>
          <input type="number" class="form-control" name="split_threshold" value="<%= config.split_threshold || 240 %>">
          <small class="text-muted">Bu karakterden uzun cevaplar parçalara bölünür (WhatsApp'ta insan hissi verir)</small>
        </div>
        <div class="form-group" style="margin-top: 16px;">
          <label class="form-label">
            Parçalar Arası Bekleme
            <span class="badge badge-secondary" id="chunkVal"><%= config.chunk_delay || 800 %> ms</span>
          </label>
          <input type="range" class="form-control" name="chunk_delay" min="300" max="3000" step="100"
                 value="<%= config.chunk_delay || 800 %>"
                 oninput="document.getElementById('chunkVal').innerText = this.value + ' ms'">
          <small class="text-muted">Her parça gönderimi arasındaki bekleme süresi</small>
        </div>
      </div>
    </div>
  </div>

  <!-- Kaydet Butonu -->
  <div class="card">
    <div class="card-body" style="text-align: center;">
      <button type="submit" class="btn btn-primary btn-lg">
        <i class="fas fa-save"></i> Ayarları Kaydet
      </button>
    </div>
  </div>
</form>

<style>
/* Switch Card Styles */
.switch-card {
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: 16px 20px;
  background: var(--bg-secondary);
  border-radius: 10px;
  border: 1px solid var(--border-color);
}
.switch-info { flex: 1; }
.switch-title { font-weight: 600; color: var(--text-primary); margin-bottom: 2px; }
.switch-desc { font-size: 12px; color: var(--text-muted); }

/* Toggle Switch */
.switch {
  position: relative;
  display: inline-block;
  width: 50px;
  height: 26px;
}
.switch input { opacity: 0; width: 0; height: 0; }
.slider {
  position: absolute;
  cursor: pointer;
  top: 0; left: 0; right: 0; bottom: 0;
  background-color: #ccc;
  transition: .3s;
  border-radius: 26px;
}
.slider:before {
  position: absolute;
  content: "";
  height: 20px;
  width: 20px;
  left: 3px;
  bottom: 3px;
  background-color: white;
  transition: .3s;
  border-radius: 50%;
}
input:checked + .slider { background-color: #25D366; }
input:checked + .slider:before { transform: translateX(24px); }
</style>

<%- include('partials/footer') %>